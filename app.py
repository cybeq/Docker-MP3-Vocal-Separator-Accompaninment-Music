from flask import Flask, send_file, request, render_template
import os
import subprocess
import zipfile

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/convert', methods=['POST'])
def download_file():
    if 'file' not in request.files:
        return 'No file uploaded.'

    file = request.files['file']
    if file.filename == '':
        return 'No file selected.'
    _, ext = os.path.splitext(file.filename)
    if ext != '.mp3':
        return 'Only MP3 files are allowed.'
    filepath = os.path.join(os.path.dirname(os.path.abspath(__file__)), 'file.mp3')
    file.save(filepath)

    subprocess.run(["spleeter", "separate", "-p", "spleeter:2stems", "-o", "output", "file.mp3"], check=True)

    zip_filename = 'vocals_and_accompaniment.zip'
    zip_filepath = os.path.join('output', 'file', zip_filename)
    filepaths = ['output/file/vocals.wav', 'output/file/accompaniment.wav']

    with zipfile.ZipFile(zip_filepath, 'w') as zip_file:
        for filepath in filepaths:
            if os.path.exists(filepath):
                zip_file.write(filepath)
            else:
                raise FileNotFoundError(f'File "{filepath}" not found.')

    return send_file(zip_filepath, as_attachment=True)



if __name__ == '__main__':
    app.run(host='0.0.0.0')
#
# MIT License
#
# Copyright (c) 2019-present, Deezer SA.
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.



#Lorem ipsum dolor sit amet, consectetur adipisicing elit. A ad beatae blanditiis, est ex labore libero maxime, necessitatibus quae quasi, temporibus vitae voluptas voluptate. Aliquid autem cupiditate debitis doloremque dolores dolorum ea eligendi hic in itaque iure laudantium molestias mollitia nesciunt nobis non nulla numquam optio perspiciatis possimus quasi, quia temporibus totam ullam, veniam voluptas voluptatibus. Amet consequatur fuga magni quia ratione veritatis? Accusantium autem dolor eius fugiat impedit modi pariatur quae quos repellendus sequi tempora, vero voluptatum. Accusamus dolore ex molestias tempore vero, voluptates. Accusantium aliquam aliquid aut beatae, consequatur consequuntur cum deserunt doloremque ducimus esse eum excepturi fuga incidunt ipsam labore laboriosam magnam minima minus modi mollitia nisi nostrum obcaecati odio odit perferendis perspiciatis porro possimus praesentium provident quae quibusdam reiciendis repellendus repudiandae saepe tempora vel velit. Blanditiis laboriosam molestiae quia sint? Ab accusamus ad animi beatae dignissimos doloremque eaque, ipsum magni maiores minima modi necessitatibus nisi quos reiciendis sunt suscipit ut! Accusamus eum illo minus non quam quibusdam reiciendis saepe sapiente, voluptatem? Aut consequuntur cum, dolorum eius esse laboriosam laudantium libero nemo nisi nobis nostrum placeat quam quas quidem ratione repellendus saepe veritatis? Accusantium amet animi asperiores autem consequuntur, cumque debitis expedita explicabo fuga id illum in incidunt iure labore laboriosam minima minus modi molestias necessitatibus nobis numquam optio porro quam quas qui quisquam quos rerum tempora temporibus unde veniam veritatis voluptas voluptatibus? Animi aperiam asperiores commodi culpa dolores eum illum maxime nemo perspiciatis voluptas. Culpa dolorem, eius fugit harum non perferendis placeat quibusdam ratione tempore tenetur veritatis vero voluptatibus. Assumenda deserunt distinctio ea fuga laudantium, libero molestias nesciunt non pariatur, quae similique sit tempora voluptatum! Architecto culpa quisquam reiciendis suscipit totam veniam. Ab expedita libero repudiandae vitae? Accusantium aliquid asperiores assumenda at aut beatae, consequuntur culpa esse eum excepturi illo incidunt, inventore itaque molestiae necessitatibus nesciunt officia perferendis perspiciatis porro quam quibusdam quisquam quod ratione saepe totam vero voluptas voluptate! A, aperiam culpa cupiditate ducimus ex illo labore maxime placeat soluta voluptatum. Ad aspernatur autem dolorem et facere hic id, laboriosam minima porro. Aliquam asperiores debitis delectus dolor eaque, eius facere facilis hic illo illum incidunt ipsum iure laborum, laudantium libero modi nemo nesciunt nostrum obcaecati quod repellat repellendus sapiente sed similique sunt suscipit tempora ut? Alias asperiores deleniti eligendi fuga molestias praesentium repellat sed ut velit voluptatem. Aperiam eligendi exercitationem fugiat, id praesentium saepe voluptates voluptatum. Adipisci alias aliquam consectetur cumque cupiditate dolorem dolores error est et hic illum ipsam itaque magnam maxime minima modi mollitia nemo nisi non omnis, quam quidem quisquam repellat reprehenderit sit tempore unde voluptatum. Atque autem blanditiis cupiditate deserunt distinctio dolor dolores eius est, facilis inventore itaque iusto laudantium minus mollitia natus perspiciatis provident sit sunt tempora ut! Amet, at atque distinctio dolore enim et ipsam laudantium magnam, minima molestiae neque, nobis omnis possimus quas quia repellendus sapiente vel velit vero voluptatum! Ad asperiores assumenda at corporis cumque deserunt dolore ducimus enim eos error eveniet ex exercitationem expedita facere fugiat, id illum itaque, laborum magnam necessitatibus odit optio placeat quam quas quis quos repellat rerum sapiente similique sit suscipit totam ullam ut velit vero voluptas voluptatem. A adipisci consequuntur cupiditate ex excepturi quos sit temporibus voluptatem voluptatibus. A cupiditate deserunt, ducimus earum illo ipsam magnam minus nam nisi possimus quis repellat sapiente sunt ut voluptates! Aspernatur delectus, doloremque eos harum hic omnis placeat tenetur. Accusantium, ad adipisci aliquam dicta dolorum eos ex excepturi facilis sit voluptate. Aliquid aperiam aut blanditiis consectetur deleniti ea eaque, eligendi explicabo fuga laboriosam laborum libero nihil odit pariatur, quam reprehenderit temporibus tenetur unde velit voluptatum! Ad, aut doloribus est in itaque placeat reprehenderit? A asperiores atque aut beatae cum cupiditate dignissimos est facere incidunt iusto, porro quis. Ad alias amet assumenda blanditiis culpa dicta dolor doloremque dolores, dolorum ducimus eaque earum, eos et exercitationem explicabo impedit incidunt inventore ipsam iste laboriosam mollitia nemo nobis, non nulla obcaecati optio praesentium quaerat quam quas qui quibusdam repellendus reprehenderit sequi tempore tenetur totam voluptates. Neque odit quos voluptatum? Debitis error non sunt! Accusamus accusantium alias aperiam architecto at consequatur consequuntur corporis cum cumque dolorum ea eaque esse expedita id illo impedit incidunt ipsa laboriosam minima nam necessitatibus nostrum odio praesentium quaerat, quasi quia quidem quis unde voluptatem voluptatibus? Accusantium ducimus eos repudiandae voluptate! Aperiam deserunt, dolore dolorum ea eaque earum impedit in iusto maiores minus mollitia placeat quo saepe veniam veritatis? Assumenda autem consequatur delectus deserunt ducimus enim eos esse, fuga fugit, illo ipsam iure libero magnam magni maxime natus nihil numquam perferendis porro provident similique, sit voluptatibus. Ab beatae commodi debitis impedit magni modi nam nemo, nobis quis, ratione recusandae saepe sunt tenetur! Cupiditate ex excepturi explicabo ipsa iusto quaerat sapiente voluptate? Adipisci consectetur, cum earum ex facere ipsa laborum magnam, officiis possimus qui, similique voluptates? Aliquid aut dolor est hic incidunt iure nihil, quia quo repudiandae.Lorem ipsum dolor sit amet, consectetur adipisicing elit. A ad beatae blanditiis, est ex labore libero maxime, necessitatibus quae quasi, temporibus vitae voluptas voluptate. Aliquid autem cupiditate debitis doloremque dolores dolorum ea eligendi hic in itaque iure laudantium molestias mollitia nesciunt nobis non nulla numquam optio perspiciatis possimus quasi, quia temporibus totam ullam, veniam voluptas voluptatibus. Amet consequatur fuga magni quia ratione veritatis? Accusantium autem dolor eius fugiat impedit modi pariatur quae quos repellendus sequi tempora, vero voluptatum. Accusamus dolore ex molestias tempore vero, voluptates. Accusantium aliquam aliquid aut beatae, consequatur consequuntur cum deserunt doloremque ducimus esse eum excepturi fuga incidunt ipsam labore laboriosam magnam minima minus modi mollitia nisi nostrum obcaecati odio odit perferendis perspiciatis porro possimus praesentium provident quae quibusdam reiciendis repellendus repudiandae saepe tempora vel velit. Blanditiis laboriosam molestiae quia sint? Ab accusamus ad animi beatae dignissimos doloremque eaque, ipsum magni maiores minima modi necessitatibus nisi quos reiciendis sunt suscipit ut! Accusamus eum illo minus non quam quibusdam reiciendis saepe sapiente, voluptatem? Aut consequuntur cum, dolorum eius esse laboriosam laudantium libero nemo nisi nobis nostrum placeat quam quas quidem ratione repellendus saepe veritatis? Accusantium amet animi asperiores autem consequuntur, cumque debitis expedita explicabo fuga id illum in incidunt iure labore laboriosam minima minus modi molestias necessitatibus nobis numquam optio porro quam quas qui quisquam quos rerum tempora temporibus unde veniam veritatis voluptas voluptatibus? Animi aperiam asperiores commodi culpa dolores eum illum maxime nemo perspiciatis voluptas. Culpa dolorem, eius fugit harum non perferendis placeat quibusdam ratione tempore tenetur veritatis vero voluptatibus. Assumenda deserunt distinctio ea fuga laudantium, libero molestias nesciunt non pariatur, quae similique sit tempora voluptatum! Architecto culpa quisquam reiciendis suscipit totam veniam. Ab expedita libero repudiandae vitae? Accusantium aliquid asperiores assumenda at aut beatae, consequuntur culpa esse eum excepturi illo incidunt, inventore itaque molestiae necessitatibus nesciunt officia perferendis perspiciatis porro quam quibusdam quisquam quod ratione saepe totam vero voluptas voluptate! A, aperiam culpa cupiditate ducimus ex illo labore maxime placeat soluta voluptatum. Ad aspernatur autem dolorem et facere hic id, laboriosam minima porro. Aliquam asperiores debitis delectus dolor eaque, eius facere facilis hic illo illum incidunt ipsum iure laborum, laudantium libero modi nemo nesciunt nostrum obcaecati quod repellat repellendus sapiente sed similique sunt suscipit tempora ut? Alias asperiores deleniti eligendi fuga molestias praesentium repellat sed ut velit voluptatem. Aperiam eligendi exercitationem fugiat, id praesentium saepe voluptates voluptatum. Adipisci alias aliquam consectetur cumque cupiditate dolorem dolores error est et hic illum ipsam itaque magnam maxime minima modi mollitia nemo nisi non omnis, quam quidem quisquam repellat reprehenderit sit tempore unde voluptatum. Atque autem blanditiis cupiditate deserunt distinctio dolor dolores eius est, facilis inventore itaque iusto laudantium minus mollitia natus perspiciatis provident sit sunt tempora ut! Amet, at atque distinctio dolore enim et ipsam laudantium magnam, minima molestiae neque, nobis omnis possimus quas quia repellendus sapiente vel velit vero voluptatum! Ad asperiores assumenda at corporis cumque deserunt dolore ducimus enim eos error eveniet ex exercitationem expedita facere fugiat, id illum itaque, laborum magnam necessitatibus odit optio placeat quam quas quis quos repellat rerum sapiente similique sit suscipit totam ullam ut velit vero voluptas voluptatem. A adipisci consequuntur cupiditate ex excepturi quos sit temporibus voluptatem voluptatibus. A cupiditate deserunt, ducimus earum illo ipsam magnam minus nam nisi possimus quis repellat sapiente sunt ut voluptates! Aspernatur delectus, doloremque eos harum hic omnis placeat tenetur. Accusantium, ad adipisci aliquam dicta dolorum eos ex excepturi facilis sit voluptate. Aliquid aperiam aut blanditiis consectetur deleniti ea eaque, eligendi explicabo fuga laboriosam laborum libero nihil odit pariatur, quam reprehenderit temporibus tenetur unde velit voluptatum! Ad, aut doloribus est in itaque placeat reprehenderit? A asperiores atque aut beatae cum cupiditate dignissimos est facere incidunt iusto, porro quis. Ad alias amet assumenda blanditiis culpa dicta dolor doloremque dolores, dolorum ducimus eaque earum, eos et exercitationem explicabo impedit incidunt inventore ipsam iste laboriosam mollitia nemo nobis, non nulla obcaecati optio praesentium quaerat quam quas qui quibusdam repellendus reprehenderit sequi tempore tenetur totam voluptates. Neque odit quos voluptatum? Debitis error non sunt! Accusamus accusantium alias aperiam architecto at consequatur consequuntur corporis cum cumque dolorum ea eaque esse expedita id illo impedit incidunt ipsa laboriosam minima nam necessitatibus nostrum odio praesentium quaerat, quasi quia quidem quis unde voluptatem voluptatibus? Accusantium ducimus eos repudiandae voluptate! Aperiam deserunt, dolore dolorum ea eaque earum impedit in iusto maiores minus mollitia placeat quo saepe veniam veritatis? Assumenda autem consequatur delectus deserunt ducimus enim eos esse, fuga fugit, illo ipsam iure libero magnam magni maxime natus nihil numquam perferendis porro provident similique, sit voluptatibus. Ab beatae commodi debitis impedit magni modi nam nemo, nobis quis, ratione recusandae saepe sunt tenetur! Cupiditate ex excepturi explicabo ipsa iusto quaerat sapiente voluptate? Adipisci consectetur, cum earum ex facere ipsa laborum magnam, officiis possimus qui, similique voluptates? Aliquid aut dolor est hic incidunt iure nihil, quia quo repudiandae.